(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{1092:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var r=t(18),a=t(5893),s=t(7757),i=t.n(s),o=t(2137),c=t(2592),u=t(9008),l=t(7294),d=t(5503);t(6690),t(3759),t(7895);d.Z.apps.length||d.Z.initializeApp({apiKey:"AIzaSyD682TiM3lkMAtCJgfv-NVA5j-KyRYLnUI",authDomain:"vaccinepassport-dev.firebaseapp.com",projectId:"vaccinepassport-dev",storageBucket:"vaccinepassport-dev.appspot.com",messagingSenderId:"300460643704",appId:"1:300460643704:web:078a83447ebbe7afb7648d"});var p=d.Z;function f(e){var n=e.url,t=(0,l.useState)(""),r=t[0],s=t[1];return(0,l.useEffect)((function(){c.toDataURL(n,{errorCorrectionLevel:"H",type:"image/png",scale:8,color:{dark:"#059669FF"}},(function(e,n){if(e)throw e;s(n)}))}),[n]),(0,a.jsx)("img",{src:r,alt:"Scan QR Code to see vaccination card."})}function h(e){var n=e.token,t=e.setImageUrl,r=(0,l.useRef)(null),s=(0,l.useState)(null),c=s[0],u=s[1];return(0,a.jsxs)("form",{onSubmit:function(){var e=(0,o.Z)(i().mark((function e(a){var s,o,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),s=r.current.files[0],(o=new FormData).append("file",s),e.next=6,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/uploadImage",{method:"POST",body:o,headers:new Headers({Authorization:"Bearer ".concat(n)})});case 6:return c=e.sent,e.next=9,c.json();case 9:u=e.sent,l=u.payload.imageUrl,t(l);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,a.jsx)("div",{children:(0,a.jsx)("label",{htmlFor:"image",children:"Upload Your Vaccine Card:"})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{name:"image",type:"file",accept:"image/png, image/jpeg",ref:r,onChange:function(){var e=r.current.files[0],n=new FileReader;n.onload=function(){u(n.result)},n.readAsDataURL(e)}})}),(0,a.jsx)("div",{children:c&&(0,a.jsx)("img",{src:c})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"submit",value:"Upload",disabled:!n||!c})})]})}function v(e){var n=e.imageUrl,t=e.setImageUrl,s=e.token,c=(0,l.useState)(null),u=c[0],d=c[1],h=(0,l.useState)([]),v=h[0],x=h[1],m=(0,l.useState)(!1),g=m[0],j=m[1],w=p.auth().currentUser.uid;(0,l.useEffect)((function(){var e=p.firestore().collection("users").doc(w);console.log("outside snapshot tickets"),console.log(u);var n=e.onSnapshot((function(e){var n=e.data();if(n){var t=n.tickets;x((function(e){for(var n=Date.now(),a=new Set(e),s=0,i=Object.keys(t);s<i.length;s++){var o=i[s];t[o].expiration.toMillis()<n&&a.add(o)}return(0,r.Z)(a)})),d(t)}}));return function(){console.log("unsubscribe"),n()}}),[w]);var k=new URL(n,location.href),b=function(){if(!u)return{nextHash:null,nextExpiration:null,nextCode:null};for(var e=Object.keys(u),n=new Set(v),t=null,r=null,a=null,s=0,i=e;s<i.length;s++){var o=i[s];n.has(o)||(!r||u[o].expiration.toMillis()<r)&&(r=u[o].expiration.toMillis(),t=o,a=u[o].code)}return{nextHash:t,nextExpiration:r,nextCode:a}}(),S=b.nextHash,U=(b.nextExpiration,b.nextCode);return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:S&&(0,a.jsxs)("div",{children:["Request to view your image. Code: ",U," ",(0,a.jsx)("button",{onClick:(0,o.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/approveTicket"+"?hash=".concat(S),{method:"POST",headers:new Headers({Authorization:"Bearer ".concat(s)})});case 2:e.sent,(n=new Set(v)).add(S),x((0,r.Z)(n));case 6:case"end":return e.stop()}}),e)}))),children:"Approve"})," ",(0,a.jsx)("button",{onClick:function(){var e=new Set(v);e.add(S),x((0,r.Z)(e))},children:"Deny"})]})}),(0,a.jsx)("div",{children:(0,a.jsx)(f,{url:k.href})}),(0,a.jsx)("button",{onClick:(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.next=3,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/deleteUser",{method:"POST",headers:new Headers({Authorization:"Bearer ".concat(s)})});case 3:e.sent,t(null);case 5:case"end":return e.stop()}}),e)}))),disabled:g,children:"Delete Image and Data"})]})}function x(){var e=(0,l.useState)(null),n=e[0],t=e[1],r=(0,l.useState)(null),s=r[0],c=r[1],d=(0,l.useState)(!0),f=d[0],x=d[1];return(0,l.useEffect)((function(){(0,o.Z)(i().mark((function e(){var n,r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.auth().signInAnonymously();case 2:return n=e.sent,e.next=5,n.user.getIdToken();case 5:return r=e.sent,t(r),e.next=9,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/getUrl",{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(r)})});case 9:return a=e.sent,e.next=12,a.json();case 12:s=e.sent,o=s.payload.imageUrl,c(o),x(!1);case 16:case"end":return e.stop()}}),e)})))()}),[]),(0,a.jsxs)("div",{children:[(0,a.jsxs)(u.default,{children:[(0,a.jsx)("title",{children:"DIY Vaccine Passport"}),(0,a.jsx)("link",{rel:"icon",href:"/vaccine.png"})]}),(0,a.jsx)("main",{children:f?(0,a.jsx)("div",{children:"Loading..."}):s?(0,a.jsx)(v,{imageUrl:s,setImageUrl:c,token:n}):(0,a.jsx)(h,{setImageUrl:c,token:n})}),(0,a.jsx)("footer",{})]})}},5301:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(1092)}])}},function(e){e.O(0,[774,17,834,351,139],(function(){return n=5301,e(e.s=n);var n}));var n=e.O();_N_E=n}]);