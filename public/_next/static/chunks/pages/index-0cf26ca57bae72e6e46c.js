(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3607:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5893);function s(){return(0,r.jsxs)("footer",{className:"text-center text-sm p-4 pt-8",children:[(0,r.jsx)("p",{children:"Created by Yi Ding. Designed by Anna Ding."}),(0,r.jsxs)("p",{children:["Roll your own at:"," ",(0,r.jsx)("a",{href:"https://github.com/yisding/vaccinepassport",children:"https://github.com/yisding/vaccinepassport"})]})]})}},9955:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5893);function s(e){var t=e.title;return(0,r.jsx)("header",{className:"bg-blue-500 p-4 text-center text-white text-2xl",children:(0,r.jsx)("h1",{children:t})})}},1092:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(18),s=n(5893),a=n(7757),i=n.n(a),c=n(2137),l=n(2592),o=n(9008),u=n(7294),d=n(5503);n(6690),n(3759),n(7895);d.Z.apps.length||d.Z.initializeApp({apiKey:"AIzaSyD682TiM3lkMAtCJgfv-NVA5j-KyRYLnUI",authDomain:"vaccinepassport-dev.firebaseapp.com",projectId:"vaccinepassport-dev",storageBucket:"vaccinepassport-dev.appspot.com",messagingSenderId:"300460643704",appId:"1:300460643704:web:078a83447ebbe7afb7648d"});var p=d.Z,x=n(3607),h=n(9955);function f(e){var t=e.url,n=(0,u.useState)(""),r=n[0],a=n[1];return(0,u.useEffect)((function(){l.toDataURL(t,{errorCorrectionLevel:"H",type:"image/png",scale:8,color:{dark:"#059669FF",light:"#F9FAFBFF"}},(function(e,t){if(e)throw e;a(t)}))}),[t]),(0,s.jsx)("img",{src:r,alt:"Scan QR Code to see vaccination card."})}function v(e){var t=e.url,n=(0,u.useState)(!1),r=n[0],a=n[1];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:"underline text-sm",onClick:(0,c.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.writeText(t);case 2:a(!0);case 3:case"end":return e.stop()}}),e)}))),children:"Copy viewing link to clipboard"})}),(0,s.jsx)("div",{className:"text-sm",children:r?"Copied!":"\xa0"})]})}function m(){return(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12.588",height:"20.141",viewBox:"0 0 12.588 20.141",children:(0,s.jsx)("path",{d:"M97.469,59.762a1.8,1.8,0,0,0,0-2.562,1.823,1.823,0,0,0-2.562,0l-6.4,6.4-6.416-6.4a1.811,1.811,0,0,0-2.562,2.562l7.7,7.7a1.823,1.823,0,0,0,2.562,0Z",transform:"translate(68.624 -78.363) rotate(90)",fill:"#3b3434",stroke:"rgba(0,0,0,0)",strokeWidth:"1"})})}function g(e){var t=e.token,n=e.setImageUrl,r=(0,u.useRef)(null),a=(0,u.useState)(null),l=a[0],o=a[1];return(0,s.jsx)("form",{onSubmit:function(){var e=(0,c.Z)(i().mark((function e(s){var a,c,l,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.preventDefault(),a=r.current.files[0],(c=new FormData).append("file",a),e.next=6,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/uploadImage",{method:"POST",body:c,headers:new Headers({Authorization:"Bearer ".concat(t)})});case 6:return l=e.sent,e.next=9,l.json();case 9:o=e.sent,u=o.payload.imageUrl,n(u);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{id:"image",type:"file",accept:"image/png, image/jpeg",ref:r,onChange:function(){if(1===r.current.files.length){var e=r.current.files[0],t=new FileReader;t.onload=function(){o(t.result)},t.readAsDataURL(e)}else o(null)},style:{opacity:0,position:"absolute",height:.1,width:.1}}),(0,s.jsx)("div",{children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:"p-4",onClick:function(e){e.preventDefault(),r.current.value="",o(null)},children:(0,s.jsx)(m,{})})}),(0,s.jsxs)("div",{className:"text-center pt-12",children:[(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("img",{src:l})}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)("input",{type:"submit",value:"Create My QR Code",disabled:!t||!l,className:"bg-blue-500 rounded-full py-2 px-4 text-white text-lg"})})]})]}):(0,s.jsxs)("div",{className:"py-32 text-center",children:[(0,s.jsx)("div",{className:"hidden md:block text-lg px-10 py-4",children:"Feel free to try this anywhere, but you probably want to use this on your phone."}),(0,s.jsx)("div",{className:"text-lg px-10",children:"Take a photo or upload a photo of your vaccine card."}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)("label",{htmlFor:"image",className:"bg-blue-500 rounded-full py-2 px-4 text-white text-lg",children:"Upload Card"})})]})})]})})}function j(e){var t=e.imageUrl,n=e.setImageUrl,a=e.token,l=(0,u.useState)(null),o=l[0],d=l[1],x=(0,u.useState)([]),h=x[0],m=x[1],g=(0,u.useState)(!1),j=g[0],w=g[1],b=p.auth().currentUser.uid;(0,u.useEffect)((function(){var e=p.firestore().collection("users").doc(b);console.log("outside snapshot tickets"),console.log(o);var t=e.onSnapshot((function(e){var t=e.data();if(t){var n=t.tickets;m((function(e){for(var t=Date.now(),s=new Set(e),a=0,i=Object.keys(n);a<i.length;a++){var c=i[a];(n[c].expiration.toMillis()<t||n[c].approved)&&s.add(c)}return(0,r.Z)(s)})),d(n)}}));return function(){console.log("unsubscribe"),t()}}),[b]);var y=new URL(t,location.href),k=function(){if(!o)return{nextHash:null,nextExpiration:null,nextCode:null};for(var e=Object.keys(o),t=new Set(h),n=null,r=null,s=null,a=0,i=e;a<i.length;a++){var c=i[a];t.has(c)||(!r||o[c].expiration.toMillis()<r)&&(r=o[c].expiration.toMillis(),n=c,s=o[c].code)}return{nextHash:n,nextExpiration:r,nextCode:s}}(),N=k.nextHash,S=(k.nextExpiration,k.nextCode);return(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl pt-20",children:"Ready to Scan"}),(0,s.jsxs)("div",{className:"py-4 mx-auto w-56",children:[(0,s.jsx)(f,{url:y.href}),(0,s.jsx)(v,{url:y.href})]}),(0,s.jsx)("div",{children:N?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-2xl px-8",children:[(0,s.jsx)("p",{children:"You have a request to view your image."}),(0,s.jsxs)("p",{children:["Code: ",S]})]}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)("button",{onClick:(0,c.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/approveTicket"+"?hash=".concat(N),{method:"POST",headers:new Headers({Authorization:"Bearer ".concat(a)})});case 2:e.sent,(t=new Set(h)).add(N),m((0,r.Z)(t));case 6:case"end":return e.stop()}}),e)}))),className:"bg-blue-500 rounded-full py-2 px-4 text-white text-lg",children:"Approve"})}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{onClick:function(){var e=new Set(h);e.add(N),m((0,r.Z)(e))},className:"bg-white rounded-full py-2 px-4 text-red-500 text-lg border-gray-600 border-2",children:"Deny"})})]}):(0,s.jsx)("button",{onClick:(0,c.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.next=3,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/deleteUser",{method:"POST",headers:new Headers({Authorization:"Bearer ".concat(a)})});case 3:e.sent,n(null);case 5:case"end":return e.stop()}}),e)}))),disabled:j,className:"mt-8 bg-red-600 rounded-full py-2 px-4 text-white text-lg",children:"Delete Image and Data"})})]})}function w(){var e=(0,u.useState)(null),t=e[0],n=e[1],r=(0,u.useState)(null),a=r[0],l=r[1],d=(0,u.useState)(!0),f=d[0],v=d[1];return(0,u.useEffect)((function(){(0,c.Z)(i().mark((function e(){var t,r,s,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.auth().signInAnonymously();case 2:return t=e.sent,e.next=5,t.user.getIdToken();case 5:return r=e.sent,n(r),e.next=9,fetch("https://us-central1-vaccinepassport-dev.cloudfunctions.net/getUrl",{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(r)})});case 9:return s=e.sent,e.next=12,s.json();case 12:a=e.sent,c=a.payload.imageUrl,l(c),v(!1);case 16:case"end":return e.stop()}}),e)})))()}),[]),(0,s.jsxs)("div",{className:"flex flex-col min-h-full bg-gray-50",children:[(0,s.jsxs)(o.default,{children:[(0,s.jsx)("title",{children:"DIY Vaccine Passport"}),(0,s.jsx)("link",{rel:"icon",href:"/vaccine.png"})]}),(0,s.jsx)(h.Z,{title:"DIY Vaccine Passport"}),(0,s.jsx)("main",{className:"flex-grow",children:f?(0,s.jsx)("div",{className:"pt-8 text-2xl text-center",children:"Loading..."}):a?(0,s.jsx)(j,{imageUrl:a,setImageUrl:l,token:t}):(0,s.jsx)(g,{setImageUrl:l,token:t})}),(0,s.jsx)(x.Z,{})]})}},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1092)}])}},function(e){e.O(0,[774,200,834,351,139],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);